<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NES Emulator</title>
</head>
<body>
<div style="text-align: center;">
	<h1>NES Emulator</h1>
	<canvas id="nes-canvas" width="256" height="240" style="border: 1px solid black;"></canvas>
	<br>
	<input type="file" id="rom-upload" accept=".nes">
	<p>Use arrow keys, enter (start), space (select), X (A), and C (B)</p>
</div>
<script src="emscripten.js"></script>
<script>
	var canvas = document.getElementById('nes-canvas');
	var Module = {
		canvas: canvas,
		onRuntimeInitialized: function() {
			var input = document.getElementById('rom-upload');
			input.addEventListener('change', function() {
				var file = input.files[0];
				var reader = new FileReader();
				reader.onload = function() {
					var data = new Uint8Array(reader.result);
					Module.FS.writeFile('/rom.nes', data);
					Module._init('/rom.nes');
					requestAnimationFrame(renderFrame);
				};
				reader.readAsArrayBuffer(file);
			});

			function renderFrame() {
				Module._render(Module.canvas.getContext('2d').getImageData(0, 0, 256, 240).data.buffer);
				requestAnimationFrame(renderFrame);
			}
		}
	};
</script>
</body>
</html>
